<html>

  <head>
    <link rel="stylesheet" type="text/css" href="../style.css" />
    <script src="demo.js"></script>
    <script src="../../xbps.js"></script>

    <script id="shader-fs" type="x-shader/x-fragment">
    #ifdef GL_ES
      precision highp float;
    #endif

    varying vec4 frontColor;
    void main(void){
      gl_FragColor = frontColor;
    }
    </script>
    
    <script id="shader-vs" type="x-shader/x-vertex">
    varying vec4 frontColor;

    attribute vec3 ps_Vertex;
    attribute vec3 ps_Normal;
    attribute vec4 ps_Color;

    uniform float ps_PointSize;
    uniform vec3 ps_Attenuation;

    uniform vec3 lightPos;

    uniform mat4 ps_ModelViewMatrix;
    uniform mat4 ps_ProjectionMatrix;
    uniform mat4 ps_NormalMatrix;

    void PointLight(inout vec3 col, in vec3 ecPos, in vec3 vertNormal) {
      vec3 VP = lightPos - ecPos;
      VP = normalize( VP );
      float nDotVP = max( 0.0, dot( vertNormal, VP ));
      col += vec3(1.0, 1.0, 1.0) * nDotVP;
    }

    void main(void) {
      vec3 transNorm = vec3(ps_NormalMatrix * vec4(ps_Normal, 0.0));
      vec4 ecPos4 = ps_ModelViewMatrix * vec4(ps_Vertex, 1.0);

      vec3 col = vec3(0.0, 0.0, 0.0);
      PointLight(col, vec3(ecPos4), transNorm);

      frontColor = ps_Color * vec4(col, 1.0);

      float dist = length( ecPos4 );
      float attn = ps_Attenuation[0] + 
                  (ps_Attenuation[1] * dist) + 
                  (ps_Attenuation[2] * dist * dist);

      gl_PointSize = ps_PointSize * sqrt(1.0/attn);
      gl_Position = ps_ProjectionMatrix * ecPos4;
    }
    </script>
    
  </head>

  <body onLoad="start();" bgcolor="#DDD">
  <p>To interact with this demo, you must use Minefield with WebGL enabled on a device which has a sudden motion sensor, such as a MacBook.<br />
  Otherwise you can <a href="http://www.youtube.com/watch?v=U37owvJj3Ws">view the video</a>.
  </p> 
    <canvas id="canvas" width="500" height="500"></canvas>   
  </body>
</html>
